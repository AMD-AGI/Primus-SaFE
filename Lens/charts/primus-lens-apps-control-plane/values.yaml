#
# Primus Lens Apps Control Plane - Configuration
#
# Control plane components:
# - API: Main API service
# - Primus Safe Adapter: Integration with Primus Safe
# - Multi-Cluster Config Exporter: Multi-cluster configuration management
#

# ============================================================================
# Global Configuration
# ============================================================================
global:
  clusterName: "my-cluster"
  namespace: "primus-lens"
  
  imageRegistry:
    url: "docker.io"
    pullPolicy: "IfNotPresent"
    pullSecret: ""
  
  tracing:
    enabled: false
    endpoint: ""
    sampler: "traceidratio"
    samplerArg: "1.0"

# ============================================================================
# Infrastructure Dependencies
# ============================================================================
infrastructure:
  # Wait for PostgreSQL to be ready before starting apps that require DB
  # Set to true only when deploying alongside infrastructure for the first time
  waitForPostgres: false

# ============================================================================
# Control Plane Components
# ============================================================================
apps:
  api:
    enabled: true
    image: "primussafe/primus-lens-api:202602031846"
    replicas: 2
    httpPort: 8989
    resources: {}
    config:
      defaultClusterName: ""
      environment: "production"
      db:
        userName: "primus-lens"
      controllerConfig:
        leaderElectionId: "primus-lens-core"
        metricsPort: 19193
        healthzPort: 19194
        pprofPort: 19195
  
  primusSafeAdapter:
    enabled: true
    image: "primussafe/primus-safe-adapter:202512111803"
    replicas: 1
    httpPort: 8080
    resources:
      requests:
        cpu: "1"
        memory: "1Gi"
      limits:
        cpu: "1"
        memory: "1Gi"
    config:
      controller:
        leaderElectionId: "primus-safe-adapter"
        metricsPort: 19293
        healthzPort: 19294
        pprofPort: 19295
  
  multiClusterConfigExporter:
    enabled: true
    image: "primussafe/multi-cluster-config-exporter:202512111803"
    replicas: 1
    httpPort: 8989
    resources: {}
    config:
      prometheusPort: 8990
      excludeControlPlaneNodes: ""
      controller:
        leaderElectionId: "primus-lens-multi-cluster-config"
  
  githubRunnersExporter:
    enabled: true
    image: "primussafe/github-runners-exporter:202602031846"
    replicas: 1
    httpPort: 8991
    resources: {}
    config:
      prometheusPort: 8992
      controller:
        leaderElectionId: "primus-lens-github-runners"
  
  skillsRepository:
    enabled: true
    image: "primussafe/skills-repository:202602011111"
    replicas: 1
    httpPort: 8092
    resources:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "512Mi"
    config:
      db:
        host: ""  # Default: {release-name}-primary.{namespace}.svc
        port: 5432
        userName: "primus-lens-control-plane"
        dbName: "primus-lens-control-plane"
        sslMode: "require"
      embedding:
        enabled: false  # Enable semantic search
        provider: "openai"
        model: "BAAI/bge-m3"
        dimension: 1024
        baseURL: ""
        # Secret containing API key
        apiKeySecret:
          name: "embedding-api-key"
          key: "api-key"
      discovery:
        syncInterval: "5m"
        watchEnabled: false
        sources: []
      # SaFE API server configuration for user role resolution
      safeAPI:
        # Base URL of the SaFE API server (for admin detection)
        # Default assumes SaFE apiserver is in the primus-safe namespace
        baseURL: "http://primus-safe-apiserver.primus-safe.svc:8088"
      # Runner backend configuration
      runner:
        enabled: false
        baseURL: "http://localhost:8000"
        timeout: 30
      # Storage configuration for skills and uploaded files
      storage:
        provider: "local"  # local or s3
        bucket: "skills-repository"
        # S3/MinIO configuration (when provider is s3)
        s3:
          endpoint: ""
          region: "us-east-1"
          useSSL: true
          # Secret containing S3 credentials
          credentialsSecret:
            name: ""
            accessKeyField: "access-key"
            secretKeyField: "secret-key"


# ============================================================================
# Service Account Configuration
# ============================================================================
serviceAccount:
  create: false
  name: "primus-lens-app"

