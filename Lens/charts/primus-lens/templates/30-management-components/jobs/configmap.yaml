{{- if and (eq (include "primus-lens.management.enabled" .) "true") .Values.management.jobs.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "primus-lens.fullname" . }}-jobs-management-config
  namespace: {{ .Values.global.namespace }}
  labels:
    {{- include "primus-lens.labels" . | nindent 4 }}
    app.kubernetes.io/component: jobs-management
data:
  config.yaml: |
    mode: {{ .Values.management.jobs.mode }}
    grpcPort: {{ .Values.management.jobs.service.grpcPort }}
    multiCluster: false
    
    # Management mode enabled jobs
    enabledJobs:
      {{- range .Values.management.jobs.enabledJobs }}
      - {{ . }}
      {{- end }}
    
    # Job intervals (seconds)
    intervals:
      gpuAllocation: 30
      gpuConsumers: 30
      storageScan: 60
    
    database:
      host: ${DB_HOST}
      port: ${DB_PORT}
      database: ${DB_NAME}
      user: ${DB_USER}
      password: ${DB_PASSWORD}
{{- end }}

