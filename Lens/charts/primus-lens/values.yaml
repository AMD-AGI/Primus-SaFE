# Primus-Lens Helm Chart Default Values

# 部署模式: management | data | all-in-one
deploymentMode: all-in-one

# 全局配置
global:
  # 集群名称
  clusterName: my-cluster
  
  # 命名空间
  namespace: primus-lens
  
  # 镜像配置
  imageRegistry: docker.io
  imagePullPolicy: IfNotPresent
  
  # 镜像拉取 Secret
  imagePullSecrets:
    - name: primus-lens-image
  
  # 资源配置档案: minimal | normal | large
  profile: normal
  
  # 存储配置
  storageClass: standard
  
  # 访问模式: ReadWriteOnce | ReadWriteMany
  accessMode: ReadWriteOnce

# ServiceAccount 配置
serviceAccount:
  # 是否创建 ServiceAccount
  create: true
  # ServiceAccount 名称（为空则使用自动生成的名称）
  name: ""
  # 额外的 annotations
  annotations: {}

# System Tuner 配置
systemTuner:
  enabled: true
  image:
    repository: primus-lens/system-tuner
    tag: latest
  # 系统参数配置
  parameters:
    vmMaxMapCount: 262144      # vm.max_map_count (for Elasticsearch/OpenSearch)
    nofileLimit: 131072        # nofile limit (file descriptors)
  checkInterval: 30            # 检查间隔（秒）

# 中间件配置
middleware:
  # 是否部署中间件（auto 表示根据 deploymentMode 自动判断）
  # true: 强制部署
  # false: 不部署，连接远程中间件
  # auto: 根据 deploymentMode 自动判断
  enabled: auto
  
  # 远程中间件配置（当 enabled=false 时使用）
  remote:
    postgresql:
      host: ""
      port: 5432
      database: primus_lens
      user: primus_lens
      # 密码存放在 secret 中的 key
      existingSecret: ""
      secretPasswordKey: password
    
    opensearch:
      host: ""
      port: 9200
      # 如果需要认证
      existingSecret: ""
    
    victoriametrics:
      host: ""
      port: 8428
    
    otelCollector:
      endpoint: ""
  
  # PostgreSQL 配置
  postgresql:
    enabled: true
    operator:
      # Operator 资源配置
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
    # PostgreSQL 集群配置
    cluster:
      replicas: 2
      storage:
        dataSize: 10Gi
        backupSize: 5Gi
      resources:
        requests:
          cpu: 500m
          memory: 1Gi
        limits:
          cpu: 2000m
          memory: 4Gi
  
  # OpenSearch 配置
  opensearch:
    enabled: true
    operator:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
    # OpenSearch 集群配置
    cluster:
      replicas: 3
      storage:
        size: 50Gi
      resources:
        requests:
          cpu: 2000m
          memory: 4Gi
        limits:
          cpu: 4000m
          memory: 8Gi
  
  # VictoriaMetrics 配置
  victoriametrics:
    enabled: true
    operator:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
    
    # VMAgent 配置
    vmagent:
      replicas: 1
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 2000m
          memory: 2Gi
    
    # VMSelect 配置
    vmselect:
      replicas: 2
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 2000m
          memory: 2Gi
    
    # VMInsert 配置
    vminsert:
      replicas: 2
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 2000m
          memory: 2Gi
    
    # VMStorage 配置
    vmstorage:
      replicas: 2
      storage:
        size: 100Gi
      resources:
        requests:
          cpu: 1000m
          memory: 2Gi
        limits:
          cpu: 4000m
          memory: 8Gi
  
  # FluentBit Operator 配置
  fluentbit:
    enabled: true
    operator:
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
  
  # Otel Collector 配置
  otelCollector:
    enabled: true
    replicas: 2
    image:
      repository: otel/opentelemetry-collector
      tag: 0.91.0
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi

# 管理集群组件配置
management:
  # 是否启用管理集群组件（auto 表示根据 deploymentMode 自动判断）
  enabled: auto
  
  # Primus Lens API
  api:
    enabled: true
    replicas: 2
    image:
      repository: primus-lens/api
      tag: latest
    service:
      type: ClusterIP
      port: 8080
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
    # 额外的环境变量
    extraEnv: []
  
  # Primus SaFE Adapter
  safeAdapter:
    enabled: true
    replicas: 1
    image:
      repository: primus-lens/safe-adapter
      tag: latest
    service:
      type: ClusterIP
      port: 8081
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    extraEnv: []
  
  # Jobs (Management Mode)
  jobs:
    enabled: true
    image:
      repository: primus-lens/jobs
      tag: latest
    mode: management
    # 管理集群模式下启用的任务
    enabledJobs:
      - gpuAllocation
      - gpuConsumers
      - storageScan
    service:
      type: ClusterIP
      grpcPort: 50051
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    extraEnv: []
  
  # Telemetry Processor (Management Mode)
  telemetryProcessor:
    enabled: true
    replicas: 2
    image:
      repository: primus-lens/telemetry-processor
      tag: latest
    mode: management
    service:
      type: ClusterIP
      httpPort: 8082
      prometheusPort: 9090
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
    extraEnv: []
  
  # Multi-Cluster Config Exporter
  multiClusterConfigExporter:
    enabled: true
    image:
      repository: primus-lens/multi-cluster-config-exporter
      tag: latest
    resources:
      requests:
        cpu: 100m
        memory: 128Mi
      limits:
        cpu: 500m
        memory: 512Mi
    # 扫描间隔（秒）
    scanInterval: 30
    extraEnv: []
  
  # Grafana 配置
  grafana:
    enabled: true
    operator:
      enabled: true
      resources:
        requests:
          cpu: 100m
          memory: 128Mi
    # Grafana 实例配置
    instance:
      replicas: 1
      resources:
        requests:
          cpu: 500m
          memory: 512Mi
        limits:
          cpu: 1000m
          memory: 1Gi
    # 访问类型: ssh-tunnel | ingress
    accessType: ssh-tunnel
    # Ingress 域名（当 accessType=ingress 时使用）
    domain: ""
    # SSH Tunnel 模式下的 Nginx 代理配置
    nginx:
      enabled: true
      nodePort: 30182
      resources:
        requests:
          cpu: 100m
          memory: 128Mi

# 数据集群组件配置
data:
  # 是否启用数据集群组件（auto 表示根据 deploymentMode 自动判断）
  enabled: auto
  
  # Jobs (Data Mode)
  jobs:
    enabled: true
    image:
      repository: primus-lens/jobs
      tag: latest
    mode: data
    # 数据集群模式下启用的任务
    enabledJobs:
      - nodeInfo
      - deviceInfo
      - gpuWorkload
      - gpuPod
    service:
      type: ClusterIP
      grpcPort: 50051
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    extraEnv: []
  
  # Telemetry Processor (Data Mode)
  telemetryProcessor:
    enabled: true
    replicas: 2
    image:
      repository: primus-lens/telemetry-processor
      tag: latest
    mode: data
    service:
      type: ClusterIP
      httpPort: 8082
      prometheusPort: 9090
    resources:
      requests:
        cpu: 500m
        memory: 512Mi
      limits:
        cpu: 2000m
        memory: 2Gi
    extraEnv: []
  
  # GPU Resource Exporter
  gpuResourceExporter:
    enabled: true
    image:
      repository: primus-lens/gpu-resource-exporter
      tag: latest
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    extraEnv: []
  
  # Node Exporter
  nodeExporter:
    enabled: true
    image:
      repository: primus-lens/node-exporter
      tag: latest
    # Containerd socket 路径
    containerdSocket: /run/containerd/containerd.sock
    # Docker socket 路径（备选）
    dockerSocket: /var/run/docker.sock
    resources:
      requests:
        cpu: 200m
        memory: 256Mi
      limits:
        cpu: 1000m
        memory: 1Gi
    extraEnv: []

# 资源配置档案（从 profiles.tbl 迁移）
profiles:
  minimal:
    opensearch:
      disk: 20Gi
      memory: 2Gi
      cpu: 1000m
    postgresql:
      backup: 2Gi
      data: 5Gi
      replicas: 1
    victoriametrics:
      vmagent:
        cpu: 250m
        memory: 256Mi
      vmstorage:
        replicas: 1
        size: 50Gi
        cpu: 500m
        memory: 1Gi
      vmselect:
        replicas: 1
        cpu: 250m
        memory: 256Mi
      vminsert:
        replicas: 1
        cpu: 250m
        memory: 256Mi
  
  normal:
    opensearch:
      disk: 50Gi
      memory: 4Gi
      cpu: 2000m
    postgresql:
      backup: 5Gi
      data: 10Gi
      replicas: 2
    victoriametrics:
      vmagent:
        cpu: 500m
        memory: 512Mi
      vmstorage:
        replicas: 2
        size: 100Gi
        cpu: 1000m
        memory: 2Gi
      vmselect:
        replicas: 2
        cpu: 500m
        memory: 512Mi
      vminsert:
        replicas: 2
        cpu: 500m
        memory: 512Mi
  
  large:
    opensearch:
      disk: 100Gi
      memory: 8Gi
      cpu: 4000m
    postgresql:
      backup: 10Gi
      data: 20Gi
      replicas: 3
    victoriametrics:
      vmagent:
        cpu: 1000m
        memory: 1Gi
      vmstorage:
        replicas: 3
        size: 200Gi
        cpu: 2000m
        memory: 4Gi
      vmselect:
        replicas: 3
        cpu: 1000m
        memory: 1Gi
      vminsert:
        replicas: 3
        cpu: 1000m
        memory: 1Gi

# Kube State Metrics 配置
kubeStateMetrics:
  enabled: true
  # Kube State Metrics 版本
  version: v2.10.1

# 调试和故障排除
troubleshooting: true

