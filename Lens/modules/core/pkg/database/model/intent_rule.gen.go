// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.
// Code generated by gorm.io/gen. DO NOT EDIT.

package model

import (
	"time"
)

const TableNameIntentRule = "intent_rule"

// IntentRule mapped from table <intent_rule>
type IntentRule struct {
	ID                 int64     `gorm:"column:id;primaryKey;autoIncrement:true" json:"id"`
	DetectsField       string    `gorm:"column:detects_field;not null;comment:Detection target dimension: category, model_family, model_scale, training_method, quantization" json:"detects_field"`
	DetectsValue       string    `gorm:"column:detects_value;not null;comment:Detection target value" json:"detects_value"`
	Dimension          string    `gorm:"column:dimension;not null;comment:Matching dimension: image, cmdline, env_key, env_value, process, config, code" json:"dimension"`
	Pattern            string    `gorm:"column:pattern;not null;comment:Regular expression pattern for matching" json:"pattern"`
	Confidence         float64   `gorm:"column:confidence;not null;default:0.0;comment:Confidence score when this rule matches [0.0-1.0]" json:"confidence"`
	Reasoning          string    `gorm:"column:reasoning;comment:LLM reasoning when this rule was distilled" json:"reasoning"`
	DerivedFrom        ExtJSON   `gorm:"column:derived_from;default:[];comment:Workload UIDs used to distill this rule (JSON array)" json:"derived_from"`
	Status             string    `gorm:"column:status;not null;default:proposed;comment:Lifecycle: proposed, testing, validated, promoted, retired, rejected" json:"status"`
	BacktestResult     ExtType   `gorm:"column:backtest_result;default:{};comment:Backtest metrics + override config. priority>0 means rule overrides aggregation (JSONB)" json:"backtest_result"`
	LastBacktestedAt   *time.Time `gorm:"column:last_backtested_at;comment:Timestamp of last backtest run" json:"last_backtested_at"`
	MatchCount         int32     `gorm:"column:match_count;not null;default:0;comment:Production match count" json:"match_count"`
	CorrectCount       int32     `gorm:"column:correct_count;not null;default:0;comment:Audit-confirmed correct count" json:"correct_count"`
	FalsePositiveCount int32     `gorm:"column:false_positive_count;not null;default:0;comment:Audit-found false positive count" json:"false_positive_count"`
	CreatedAt          time.Time `gorm:"column:created_at;not null;default:now()" json:"created_at"`
	UpdatedAt          time.Time `gorm:"column:updated_at;not null;default:now()" json:"updated_at"`
}

// TableName IntentRule's table name
func (*IntentRule) TableName() string {
	return TableNameIntentRule
}

// Priority returns the override priority from backtest_result.
// 0 = normal (participates in weighted aggregation).
// >0 = override (highest-priority matched rule wins regardless of aggregation).
func (r *IntentRule) Priority() int {
	if r.BacktestResult == nil {
		return 0
	}
	raw, ok := r.BacktestResult["priority"]
	if !ok {
		return 0
	}
	switch v := raw.(type) {
	case float64:
		return int(v)
	case int:
		return v
	case int64:
		return int(v)
	}
	return 0
}
