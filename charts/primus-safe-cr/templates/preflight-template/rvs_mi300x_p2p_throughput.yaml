apiVersion: amd.com/v1
kind: AddonTemplate
metadata:
  name: rvs-mi300x-p2p-throughput
  labels:
    primus-safe.display.name: "rvs-mi300x-p2p-throughput"
    app.kubernetes.io/managed-by: Helm
  annotations:
    meta.helm.sh/release-name: {{ .Release.Name }}
    meta.helm.sh/release-namespace: {{ .Release.Namespace }}
spec:
  type: validation
  category: System
  gpuChip: amd
  gpuProduct: MI300X
  description: Use the command "rvs -c pbqt_single.conf" to do throughput test between all P2P pairs. This script can only be run on AMD MI300X chips.
  extensions:
    action: ZHBrZyAtbCB8IGdyZXAgLXEgcm9jbS12YWxpZGF0aW9uLXN1aXRlCmlmIFsgJD8gLW5lIDAgXTsgdGhlbgogIGFwdC1nZXQgdXBkYXRlID4vZGV2L251bGwgMj4mMQogIGFwdCBpbnN0YWxsIC15IHJvY20tdmFsaWRhdGlvbi1zdWl0ZSA+L2Rldi9udWxsIDI+ZXJyb3IKICBpZiBbICQ/IC1uZSAwIF07IHRoZW4KICAgIGNhdCBlcnJvciAmJiBybSAtZiBlcnJvcgogICAgZWNobyAiW0VSUk9SXSBmYWlsZWQgdG8gaW5zdGFsbCByb2NtLXZhbGlkYXRpb24tc3VpdGUiCiAgICBleGl0IDEKICBmaQogIHJtIC1mIGVycm9yCmZpCgpleHBvcnQgUEFUSD0kUEFUSDovb3B0L3JvY20vYmluCmV4cG9ydCBSVlNfQ09ORj0vb3B0L3JvY20vc2hhcmUvcm9jbS12YWxpZGF0aW9uLXN1aXRlL2NvbmYKTE9HX0ZJTEU9Ii90bXAvcGJxdF9zaW5nbGUubG9nIgpydnMgLWMgIiR7UlZTX0NPTkZ9L01JMzAwWC9wYnF0X3NpbmdsZS5jb25mIiA+JExPR19GSUxFIDI+JjEKRVhJVF9DT0RFPSQ/CmlmIFsgJEVYSVRfQ09ERSAtbmUgMCBdOyB0aGVuCiAgY2F0ICRMT0dfRklMRSAmJiBybSAtZiAkTE9HX0ZJTEUKICBlY2hvICJbRVJST1JdIHJ2cyBjb21tYW5kIGZhaWxlZCB3aXRoIGV4aXQgY29kZTogJEVYSVRfQ09ERSIKICBleGl0IDEKZmkKCmN1cnJlbnRfYWN0aW9uPSIiCndoaWxlIElGUz0gcmVhZCAtciBsaW5lOyBkbwogIGlmIGVjaG8gIiRsaW5lIiB8IGdyZXAgLXEgIkFjdGlvbiBuYW1lIjsgdGhlbgogICAgY3VycmVudF9hY3Rpb249JChlY2hvICIkbGluZSIgfCBhd2sgLUYnOicgJ3twcmludCAkMn0nKQogICAgY29udGludWUKICBmaQogIGlmIFtbICIkbGluZSIgPT0gKiIkY3VycmVudF9hY3Rpb25dIHAycCAiKiBdXTsgdGhlbgogICAgaWYgISBlY2hvICIkbGluZSIgfCBncmVwIC1xICJwZWVyczp0cnVlIjsgdGhlbgogICAgICBlY2hvICJbRVJST1JdOiAkbGluZSwgcGVlcnMgaXMgbm90IHRydWUiCiAgICAgIHJtIC1mICRMT0dfRklMRQogICAgICBleGl0IDEKICAgIGZpCiAgZWxpZiBbWyAiJGxpbmUiID09ICoiJGN1cnJlbnRfYWN0aW9uXSBwMnAtYmFuZHdpZHRoIiogXV07IHRoZW4KICAgIGlmICEgZWNobyAiJGxpbmUiIHwgZ3JlcCAtcUUgIihbMC05XStcLik/WzAtOV0rIEdCcHMiOyB0aGVuCiAgICAgIGVjaG8gIltFUlJPUl06ICRsaW5lLCB0aHJvdWdodHB1dCBpcyBub3QgZm91bmQiCiAgICAgIHJtIC1mICRMT0dfRklMRQogICAgICBleGl0IDEKICAgIGVsc2UKICAgICAgdGhyb3VnaHB1dD0kKGVjaG8gIiRsaW5lIiB8IGdyZXAgLW9FICIoWzAtOV0rXC4pP1swLTldKyBHQnBzIiB8IGF3ayAne3ByaW50ICQxfScpCiAgICAgIGlmICgoICQoZWNobyAiJHRocm91Z2hwdXQgPD0gMCIgfCBiYyAtbCkgKSk7IHRoZW4KICAgICAgICBlY2hvICJbRVJST1JdOiAkbGluZSwgdGhyb3VnaHRwdXQgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIDAiCiAgICAgICAgcm0gLWYgJExPR19GSUxFCglleGl0IDEKICAgICAgZmkKICAgIGZpCiAgZmkKZG9uZSA8ICIkTE9HX0ZJTEUiCmVjaG8gIltTVUNDRVNTXTogUDJQIGNvbm5lY3Rpdml0eSBhbmQgdGhyb3VnaHB1dCB0ZXN0cyBwYXNzZWQiCnJtIC1mICRMT0dfRklMRQpleGl0IDAK