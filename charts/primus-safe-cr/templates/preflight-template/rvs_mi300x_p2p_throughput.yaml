apiVersion: amd.com/v1
kind: AddonTemplate
metadata:
  name: rvs-mi300x-p2p-throughput
  labels:
    primus-safe.display.name: "rvs-mi300x-p2p-throughput"
    app.kubernetes.io/managed-by: Helm
  annotations:
    meta.helm.sh/release-name: {{ .Release.Name }}
    meta.helm.sh/release-namespace: {{ .Release.Namespace }}
spec:
  type: validation
  category: System
  gpuChip: amd
  gpuProduct: MI300X
  description: Use the command "rvs -c pbqt_single.conf" to do throughput test between all P2P pairs. This script can only be run on AMD MI300X chips.
  extensions:
    action: ZHBrZyAtbCB8IGdyZXAgLXEgcm9jbS12YWxpZGF0aW9uLXN1aXRlCmlmIFsgJD8gLW5lIDAgXTsgdGhlbgogIGFwdC1nZXQgdXBkYXRlCiAgYXB0IGluc3RhbGwgLXkgcm9jbS12YWxpZGF0aW9uLXN1aXRlCiAgaWYgWyAkPyAtbmUgMCBdOyB0aGVuCiAgICBlY2hvICJbRVJST1JdIGZhaWxlZCB0byBpbnN0YWxsIHJvY20tdmFsaWRhdGlvbi1zdWl0ZSIKICAgIGV4aXQgMQogIGZpIApmaQoKZXhwb3J0IFBBVEg9JFBBVEg6L29wdC9yb2NtL2JpbgpleHBvcnQgUlZTX0NPTkY9L29wdC9yb2NtL3NoYXJlL3JvY20tdmFsaWRhdGlvbi1zdWl0ZS9jb25mCkxPR19GSUxFPSIvdG1wL3BicXRfc2luZ2xlLmxvZyIKcnZzIC1jICIke1JWU19DT05GfS9NSTMwMFgvcGJxdF9zaW5nbGUuY29uZiIgPiAkTE9HX0ZJTEUKRVhJVF9DT0RFPSQ/CmlmIFsgJEVYSVRfQ09ERSAtbmUgMCBdOyB0aGVuCiAgZWNobyAiW0VSUk9SXSBydnMgY29tbWFuZCBmYWlsZWQgd2l0aCBleGl0IGNvZGU6ICRFWElUX0NPREUiCiAgZWNobyAiJE9VVFBVVCIKICBleGl0IDEKZmkKCmN1cnJlbnRfYWN0aW9uPSIiCndoaWxlIElGUz0gcmVhZCAtciBsaW5lOyBkbwogIGlmIGVjaG8gIiRsaW5lIiB8IGdyZXAgLXEgIkFjdGlvbiBuYW1lIjsgdGhlbgogICAgY3VycmVudF9hY3Rpb249JChlY2hvICIkbGluZSIgfCBhd2sgLUYnOicgJ3twcmludCAkMn0nKQogICAgY29udGludWUKICBmaQogIGlmIFtbICIkbGluZSIgPT0gKiIkY3VycmVudF9hY3Rpb25dIHAycCAiKiBdXTsgdGhlbgogICAgaWYgISBlY2hvICIkbGluZSIgfCBncmVwIC1xICJwZWVyczp0cnVlIjsgdGhlbgogICAgICBlY2hvICJbRVJST1JdOiAkbGluZSwgcGVlcnMgaXMgbm90IHRydWUiCiAgICAgIHJtIC1mICRMT0dfRklMRQogICAgICBleGl0IDEKICAgIGZpCiAgZWxpZiBbWyAiJGxpbmUiID09ICoiJGN1cnJlbnRfYWN0aW9uXSBwMnAtYmFuZHdpZHRoIiogXV07IHRoZW4KICAgIGlmICEgZWNobyAiJGxpbmUiIHwgZ3JlcCAtcUUgIihbMC05XStcLik/WzAtOV0rIEdCcHMiOyB0aGVuCiAgICAgIGVjaG8gIltFUlJPUl06ICRsaW5lLCB0aHJvdWdodHB1dCBpcyBub3QgZm91bmQiCiAgICAgIHJtIC1mICRMT0dfRklMRQogICAgICBleGl0IDEKICAgIGVsc2UKICAgICAgdGhyb3VnaHB1dD0kKGVjaG8gIiRsaW5lIiB8IGdyZXAgLW9FICIoWzAtOV0rXC4pP1swLTldKyBHQnBzIiB8IGF3ayAne3ByaW50ICQxfScpCiAgICAgIGlmICgoICQoZWNobyAiJHRocm91Z2hwdXQgPD0gMCIgfCBiYyAtbCkgKSk7IHRoZW4KICAgICAgICBlY2hvICJbRVJST1JdOiAkbGluZSwgdGhyb3VnaHRwdXQgaXMgbGVzcyB0aGFuIG9yIGVxdWFsIDAiCiAgICAgICAgcm0gLWYgJExPR19GSUxFCglleGl0IDEKICAgICAgZmkKICAgIGZpCiAgZmkKZG9uZSA8ICIkTE9HX0ZJTEUiCmVjaG8gIltTVUNDRVNTXTogUDJQIGNvbm5lY3Rpdml0eSBhbmQgdGhyb3VnaHB1dCB0ZXN0cyBwYXNzZWQiCnJtIC1mICRMT0dfRklMRQpleGl0IDAK